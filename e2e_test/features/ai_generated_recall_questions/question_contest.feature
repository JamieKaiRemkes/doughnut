@usingMockedOpenAiService
Feature: User Contests Question generation by AI
  As a learner, I want to contest the question generated by AI, so that I can get a better question for my note.

  Background:
    Given I am logged in as an existing user
    And I have a notebook with the head note "Scuba Diving"
    Given OpenAI generates this question for assistant thread "thread-first-question":
      | Question Stem                                       | Correct Choice | Incorrect Choice 1 | Incorrect Choice 2 |
      | First question | Rescue Diver   | Divemaster         | Open Water Diver   |
    And OpenAI generates this question for assistant thread "thread-second-question":
      | Question Stem         | Correct Choice | Incorrect Choice 1 | Incorrect Choice 2 |
      | Second question | Rescue Diver   | Divemaster         | Open Water Diver   |

  Scenario Outline: The generated question should be contested internally
    Given OpenAI assistant will create these thread ids in sequence: "thread-first-question, thread-second-question"
    And OpenAI evaluates the question as <Legitimate Question>
    And I learned one note "Scuba Diving" on day 1
    When I am recalling my note on day 2
    And I should be asked "<Current Question>"

    Examples:
    | Legitimate Question |  Current Question                                    |
    | legitamate          |  First question |
    | not legitamate      |  Second question |

  Scenario: I should be able to contest a question
    Given OpenAI assistant will create these thread ids in sequence: "thread-first-question, thread-second-question"
    And OpenAI evaluates the question as not legitamate
    And I learned one note "Scuba Diving" on day 1
    When I am recalling my note on day 2
    And I contest the question
    And I should be asked "Second question"
